<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒœã‚¿ãƒ³æŠ¼ä¸‹çŠ¶æ…‹</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    #status {
      font-size: 2em;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>ESP32 ãƒœã‚¿ãƒ³çŠ¶æ…‹</h1>
  <div id="status">èª­ã¿è¾¼ã¿ä¸­...</div>

  <script>
    const CHANNEL_ID = "3247896";
    const READ_API_KEY = "4B0IWZ9A8I6MQFZV";
    const FIELD_NUMBER = 1;

    const url = `https://api.thingspeak.com/channels/${CHANNEL_ID}/fields/${FIELD_NUMBER}/last.json?api_key=${READ_API_KEY}`;

    async function fetchButtonState() {
      try {
        const response = await fetch(url);
        const data = await response.json();

        const value = data[`field${FIELD_NUMBER}`];
        const createdAt = data.created_at;

        const statusDiv = document.getElementById("status");

        if (value === "1") {
          statusDiv.textContent = "ğŸš¨ ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸï¼";
        } else {
          statusDiv.textContent = "å¾…æ©Ÿä¸­";
        }

        statusDiv.textContent += `\n(${createdAt})`;
      } catch (error) {
        document.getElementById("status").textContent = "å–å¾—ã‚¨ãƒ©ãƒ¼";
        console.error(error);
      }
    }

    // åˆå›å®Ÿè¡Œ
    fetchButtonState();

    // 15ç§’ã”ã¨ã«æ›´æ–°ï¼ˆThingSpeakåˆ¶é™å¯¾ç­–ï¼‰
    setInterval(fetchButtonState, 15000);
  </script>

</body>
</html>
